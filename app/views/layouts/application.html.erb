<!DOCTYPE html>
<html>
  <head>
    <title>InspectionCms</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <style>
      /* DETECTIVE WINDOW */
      #detective-window {
        position: fixed;
        bottom: 90px; 
        left: 20px;
        width: 600px;
        max-width: 90vw;
        background-color: rgba(0, 0, 0, 0.95); 
        color: #0f0;
        border: 2px solid #0f0;
        border-radius: 8px;
        padding: 20px;
        z-index: 10000;
        box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        transition: opacity 0.2s, transform 0.2s;
        /* Default State */
        opacity: 1;
        transform: translateY(0);
      }

      /* HIDDEN STATE */
      .detective-hidden {
        opacity: 0 !important;
        pointer-events: none !important;
        transform: translateY(20px) !important;
      }

      /* FLOATING BUTTONS */
      .floating-actions {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 10001; /* Higher than window so they are always clickable */
        display: flex;
        gap: 10px;
      }

      .float-btn {
        background: #333;
        color: #fff;
        border: 1px solid #555;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s;
      }
      
      .float-btn:hover { transform: scale(1.1); background: #000; }
      #theme-toggle-btn { color: #FFD700; border-color: #FFD700; }
    </style>
  </head>

  <body data-controller="ui">
    
    <div id="detective-window" class="detective-hidden" data-ui-target="detective" style="font-family: monospace;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h3 style="margin: 0; color: #00FF00;">üïµÔ∏è Detective Report</h3>
        <button class="detective-close-btn" style="background: none; border: none; color: #00FF00; cursor: pointer; font-weight: bold;" 
                data-action="click->ui#toggleDetective">‚úï</button>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div>
          <p><strong>Reports Total:</strong> <%= Report.count %></p>
          <p><strong>View Status:</strong> <%= params[:status] || "All" %></p>
          <p><strong>Controller:</strong> <%= controller_name %>#<%= action_name %></p>
        </div>
        <div>
           <p><strong>User:</strong> <%= user_signed_in? ? current_user.email : "Guest" %></p>
           <code style="display:block; background:#333; padding:5px; font-size:0.8rem; color:#ccc;"><%= params.to_json %></code>
        </div>
      </div>
      
      <% if user_signed_in? %>
        <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #444;">
           <%= button_to "Log Out", destroy_user_session_path, method: :delete, style: "background: #dc3545; color: white; border: none; padding: 5px 10px; cursor: pointer;" %>
        </div>
      <% end %>
    </div>

    <%= yield %>

    <div class="floating-actions">
      <button class="float-btn" style="color: #00FF00; border-color: #00FF00;" title="Debugger" 
              data-action="click->ui#toggleDetective">üêû</button>
      
      <button id="theme-toggle-btn" class="float-btn" title="Dark Mode" 
              data-action="click->ui#toggleTheme">üåì</button>
    </div>

  </body>
</html>